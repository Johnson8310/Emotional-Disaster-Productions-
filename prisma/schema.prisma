// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String      @id @default(cuid())
  email        String      @unique
  passwordHash String
  name         String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  
  projects     Project[]
  audioFiles   AudioFile[]
  
  @@map("users")
}

model Project {
  id            String      @id @default(cuid())
  userId        String
  name          String
  description   String?
  bpm           Int         @default(120)
  timeSignature String      @default("4/4")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  tracks        Track[]
  audioFiles    AudioFile[]
  
  @@map("projects")
}

model AudioFile {
  id               String   @id @default(cuid())
  projectId        String
  userId           String
  originalFilename String
  storedFilename   String   @unique
  mimeType         String
  durationSeconds  Float?
  fileSizeBytes    Int
  createdAt        DateTime @default(now())
  
  project          Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  clips            Clip[]
  
  @@map("audio_files")
}

enum TrackType {
  audio
  midi
}

model Track {
  id         String    @id @default(cuid())
  projectId  String
  name       String
  type       TrackType @default(audio)
  orderIndex Int       @default(0)
  volume     Float     @default(1.0)
  pan        Float     @default(0.0)
  muted      Boolean   @default(false)
  solo       Boolean   @default(false)
  color      String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  
  project    Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  clips      Clip[]
  
  @@map("tracks")
}

model Clip {
  id                String    @id @default(cuid())
  trackId           String
  audioFileId       String
  startTimeSeconds  Float
  endTimeSeconds    Float
  clipOffsetSeconds Float     @default(0)
  name              String?
  color             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  track             Track     @relation(fields: [trackId], references: [id], onDelete: Cascade)
  audioFile         AudioFile @relation(fields: [audioFileId], references: [id], onDelete: Cascade)
  
  @@map("clips")
}
